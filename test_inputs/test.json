{"format_version":"0.2","terraform_version":"1.0.6","planned_values":{"root_module":{"resources":[{"address":"aws_iam_policy.AssumeRole_passes","mode":"managed","type":"aws_iam_policy","name":"AssumeRole_passes","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Assume roles don't need a account condition","name":"AssumeRole_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_policy.not_a_service_prinicpal_passes","mode":"managed","type":"aws_iam_policy","name":"not_a_service_prinicpal_passes","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Passes without a service principal","name":"not_a_service_prinicpal_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"AWS\": [\n          \"555555555555\",\n          \"123456789012\"\n        ]\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_policy.s3_service_principal_fails","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_fails","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Fails without an account condition","name":"Service_principal_fails","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_policy.s3_service_principal_passes","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_passes","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Passes with an account condition","name":"Service_principal_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"AWS:SourceAccount\": \"account\"\n        }\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_role.iam_for_lambda","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"iam_for_lambda","path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"aws_iam_role.iam_for_lambda_with_eni","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda_with_eni","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"iam_for_lambda_with_eni","path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"aws_iam_role_policy_attachment.lambda","mode":"managed","type":"aws_iam_role_policy_attachment","name":"lambda","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole","role":"iam_for_lambda_with_eni"},"sensitive_values":{}},{"address":"aws_lambda_function.test_lambda_with_bad_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_bad_runtime","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_lambda_with_bad_runtime","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs10.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[]},"sensitive_values":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[]}},{"address":"aws_lambda_function.test_lambda_with_good_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_good_runtime","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_lambda_with_good_runtime","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[]},"sensitive_values":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[]}},{"address":"aws_lambda_function.test_vpc_lambda_with_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_eni_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_vpc_lambda_with_eni_policy","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[{"security_group_ids":null,"subnet_ids":null}]},"sensitive_values":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[{}]}},{"address":"aws_lambda_function.test_vpc_lambda_with_missing_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_missing_eni_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_vpc_lambda_with_missing_eni_policy","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[{"security_group_ids":null,"subnet_ids":null}]},"sensitive_values":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[{}]}},{"address":"aws_security_group.bad_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"bad_ports_for_protocol","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":443}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":443}],"name":"bad_ports_for_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}},{"address":"aws_security_group.good_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"good_ports_for_protocol","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"name":"good_ports_for_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}},{"address":"aws_security_group.tcp_protocol","mode":"managed","type":"aws_security_group","name":"tcp_protocol","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443}],"name":"tcp_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}],"child_modules":[{"resources":[{"address":"module.rds.aws_cloudwatch_log_group.proxy","mode":"managed","type":"aws_cloudwatch_log_group","name":"proxy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"kms_key_id":null,"name":"/aws/rds/proxy/test-rds-proxy","name_prefix":null,"retention_in_days":14,"tags":{"CostCentre":"cal","Name":"test-rds_proxy_logs","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds_proxy_logs","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.rds.aws_db_proxy.proxy","mode":"managed","type":"aws_db_proxy","name":"proxy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"auth":[{"auth_scheme":"SECRETS","description":"The database connection string","iam_auth":"DISABLED"}],"debug_logging":false,"engine_family":"POSTGRESQL","idle_client_timeout":1800,"name":"test-rds-proxy","require_tls":true,"tags":{"CostCentre":"cal","Name":"test-rds-rds-proxy","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-rds-proxy","Terraform":"true"},"timeouts":null},"sensitive_values":{"auth":[{}],"tags":{},"tags_all":{},"vpc_security_group_ids":[],"vpc_subnet_ids":[]}},{"address":"module.rds.aws_db_proxy_default_target_group.this","mode":"managed","type":"aws_db_proxy_default_target_group","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"db_proxy_name":"test-rds-proxy","timeouts":null},"sensitive_values":{"connection_pool_config":[]}},{"address":"module.rds.aws_db_proxy_target.target","mode":"managed","type":"aws_db_proxy_target","name":"target","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"db_instance_identifier":null,"db_proxy_name":"test-rds-proxy"},"sensitive_values":{}},{"address":"module.rds.aws_db_subnet_group.rds","mode":"managed","type":"aws_db_subnet_group","name":"rds","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Managed by Terraform","name":"test-rds-subnet-group","tags":{"CostCentre":"cal","Name":"test-rds-subnet-group","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-subnet-group","Terraform":"true"}},"sensitive_values":{"subnet_ids":[],"tags":{},"tags_all":{}}},{"address":"module.rds.aws_iam_policy.read_connection_string","mode":"managed","type":"aws_iam_policy","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":null,"name":"test-rdsReadConnectionString","name_prefix":null,"path":"/","tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.rds.aws_iam_role.rds_proxy","mode":"managed","type":"aws_iam_role","name":"rds_proxy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"RDSAssume\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"rds.amazonaws.com\"\n      }\n    }\n  ]\n}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"test-rds_rds_proxy","path":"/","permissions_boundary":null,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags":{},"tags_all":{}}},{"address":"module.rds.aws_iam_role_policy_attachment.read_connection_string","mode":"managed","type":"aws_iam_role_policy_attachment","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"test-rds_rds_proxy"},"sensitive_values":{}},{"address":"module.rds.aws_rds_cluster.cluster","mode":"managed","type":"aws_rds_cluster","name":"cluster","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allow_major_version_upgrade":false,"backtrack_window":null,"backup_retention_period":7,"cluster_identifier":"test-rds-cluster","copy_tags_to_snapshot":false,"database_name":"foo","db_instance_parameter_group_name":null,"db_subnet_group_name":"test-rds-subnet-group","deletion_protection":true,"enable_global_write_forwarding":false,"enable_http_endpoint":false,"enabled_cloudwatch_logs_exports":null,"engine":"aurora-postgresql","engine_mode":"provisioned","engine_version":"13.3","global_cluster_identifier":null,"iam_database_authentication_enabled":null,"master_password":"foo","master_username":"calvin","preferred_backup_window":"07:00-09:00","replication_source_identifier":null,"restore_to_point_in_time":[],"s3_import":[],"scaling_configuration":[],"skip_final_snapshot":false,"snapshot_identifier":null,"source_region":null,"storage_encrypted":true,"tags":{"CostCentre":"cal","Name":"test-rds-cluster","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-cluster","Terraform":"true"},"timeouts":null},"sensitive_values":{"availability_zones":[],"cluster_members":[],"iam_roles":[],"master_password":true,"restore_to_point_in_time":[],"s3_import":[],"scaling_configuration":[],"tags":{},"tags_all":{},"vpc_security_group_ids":[]}},{"address":"module.rds.aws_rds_cluster_instance.instances[0]","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-0","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-0","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.rds.aws_rds_cluster_instance.instances[1]","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-1","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-1","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.rds.aws_rds_cluster_instance.instances[2]","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-2","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-2","Terraform":"true"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.rds.aws_secretsmanager_secret.connection_string","mode":"managed","type":"aws_secretsmanager_secret","name":"connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":null,"force_overwrite_replica_secret":false,"kms_key_id":null,"recovery_window_in_days":30,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"sensitive_values":{"replica":[],"rotation_rules":[],"tags":{},"tags_all":{}}},{"address":"module.rds.aws_secretsmanager_secret.proxy_connection_string","mode":"managed","type":"aws_secretsmanager_secret","name":"proxy_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":null,"force_overwrite_replica_secret":false,"kms_key_id":null,"recovery_window_in_days":30,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"sensitive_values":{"replica":[],"rotation_rules":[],"tags":{},"tags_all":{}}},{"address":"module.rds.aws_secretsmanager_secret_version.connection_string","mode":"managed","type":"aws_secretsmanager_secret_version","name":"connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"secret_binary":null,"secret_string":"{\"password\":\"foo\",\"username\":\"calvin\"}"},"sensitive_values":{"secret_string":true,"version_stages":[]}},{"address":"module.rds.aws_secretsmanager_secret_version.proxy_connection_string","mode":"managed","type":"aws_secretsmanager_secret_version","name":"proxy_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"secret_binary":null},"sensitive_values":{"secret_string":true,"version_stages":[]}},{"address":"module.rds.aws_security_group.rds_proxy","mode":"managed","type":"aws_security_group","name":"rds_proxy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"The Security group that allows communication between the proxy and the database","egress":[{"cidr_blocks":[],"description":"","from_port":5432,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":true,"to_port":5432}],"ingress":[{"cidr_blocks":[],"description":"","from_port":5432,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":true,"to_port":5432}],"name":"test-rds_rds_proxy_sg","revoke_rules_on_delete":false,"tags":{"CostCentre":"cal","Name":"test-rds_rds_proxy_sg","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds_rds_proxy_sg","Terraform":"true"},"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}},{"address":"module.rds.data.aws_iam_policy_document.read_connection_string","mode":"data","type":"aws_iam_policy_document","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["secretsmanager:DescribeSecret","secretsmanager:GetResourcePolicy","secretsmanager:GetSecretValue","secretsmanager:ListSecretVersionIds"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":[],"sid":"0"},{"actions":["secretsmanager:ListSecrets"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"1"},{"actions":["kms:Decrypt"],"condition":[{"test":"StringEquals","values":["secretsmanager.ca-central-1.amazonaws.com"],"variable":"kms:ViaService"}],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"2"}],"version":null},"sensitive_values":{"statement":[{"actions":[false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[{"values":[false]}],"not_principals":[],"principals":[],"resources":[false]}]}},{"address":"module.rds.random_string.random","mode":"managed","type":"random_string","name":"random","provider_name":"registry.terraform.io/hashicorp/random","schema_version":1,"values":{"keepers":null,"length":6,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"override_special":null,"special":false,"upper":false},"sensitive_values":{}}],"address":"module.rds"},{"resources":[{"address":"module.vpc.aws_default_network_acl.default","mode":"managed","type":"aws_default_network_acl","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"egress":[],"ingress":[],"subnet_ids":null,"tags":{"CostCentre":"cal","Name":"vpc_default_nacl","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_default_nacl","Terraform":"true"}},"sensitive_values":{"egress":[],"ingress":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_default_route_table.default","mode":"managed","type":"aws_default_route_table","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"propagating_vgws":null,"route":[],"tags":{"CostCentre":"cal","Terraform":"true","name":"vpc_default_route_table"},"tags_all":{"CostCentre":"cal","Terraform":"true","name":"vpc_default_route_table"},"timeouts":null},"sensitive_values":{"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_default_security_group.default","mode":"managed","type":"aws_default_security_group","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"revoke_rules_on_delete":false,"tags":{"CostCentre":"cal","Name":"vpc_default_sg","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_default_sg","Terraform":"true"}},"sensitive_values":{"egress":[],"ingress":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_internet_gateway.gw","mode":"managed","type":"aws_internet_gateway","name":"gw","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_internet_gateway","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_internet_gateway","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[0]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-0","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[1]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-1","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[2]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-2","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_network_acl.main","mode":"managed","type":"aws_network_acl","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_main_nacl","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_main_nacl","Terraform":"true"}},"sensitive_values":{"egress":[],"ingress":[],"subnet_ids":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_network_acl_rule.block_rdp[0]","mode":"managed","type":"aws_network_acl_rule","name":"block_rdp","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"cidr_block":"10.0.0.0/16","egress":false,"from_port":3389,"icmp_code":null,"icmp_type":null,"ipv6_cidr_block":null,"protocol":"tcp","rule_action":"deny","rule_number":51,"to_port":3389},"sensitive_values":{}},{"address":"module.vpc.aws_network_acl_rule.block_ssh[0]","mode":"managed","type":"aws_network_acl_rule","name":"block_ssh","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"cidr_block":"10.0.0.0/16","egress":false,"from_port":22,"icmp_code":null,"icmp_type":null,"ipv6_cidr_block":null,"protocol":"tcp","rule_action":"deny","rule_number":50,"to_port":22},"sensitive_values":{}},{"address":"module.vpc.aws_route.private_nat_gateway[0]","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{"timeouts":{}}},{"address":"module.vpc.aws_route.private_nat_gateway[1]","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{"timeouts":{}}},{"address":"module.vpc.aws_route.private_nat_gateway[2]","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{"timeouts":{}}},{"address":"module.vpc.aws_route.public_internet_gateway","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"local_gateway_id":null,"nat_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{"timeouts":{}}},{"address":"module.vpc.aws_route_table.private[0]","mode":"managed","type":"aws_route_table","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_0","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table.private[1]","mode":"managed","type":"aws_route_table","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_1","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table.private[2]","mode":"managed","type":"aws_route_table","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_2","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"CostCentre":"cal","Name":"vpc_public_route_table","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_route_table","Terraform":"true"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_route_table_association.private[0]","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.private[1]","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.private[2]","mode":"managed","type":"aws_route_table_association","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.public[0]","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.public[1]","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_route_table_association.public[2]","mode":"managed","type":"aws_route_table_association","name":"public","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null},"sensitive_values":{}},{"address":"module.vpc.aws_subnet.private[0]","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1a","cidr_block":"10.0.0.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1a","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1a","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"sensitive_values":{"tags":{},"tags_all":{},"timeouts":{}}},{"address":"module.vpc.aws_subnet.private[1]","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1b","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1b","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1b","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"sensitive_values":{"tags":{},"tags_all":{},"timeouts":{}}},{"address":"module.vpc.aws_subnet.private[2]","mode":"managed","type":"aws_subnet","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1d","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1d","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1d","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"sensitive_values":{"tags":{},"tags_all":{},"timeouts":{}}},{"address":"module.vpc.aws_subnet.public[0]","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1a","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1a","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1a","Terraform":"true","Tier":"Public"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.public[1]","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1b","cidr_block":"10.0.4.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1b","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1b","Terraform":"true","Tier":"Public"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.public[2]","mode":"managed","type":"aws_subnet","name":"public","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1d","cidr_block":"10.0.5.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1d","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1d","Terraform":"true","Tier":"Public"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_vpc.main","mode":"managed","type":"aws_vpc","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null,"tags":{"CostCentre":"cal","Name":"vpc_vpc","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_vpc","Terraform":"true"}},"sensitive_values":{"tags":{},"tags_all":{}}}],"address":"module.vpc"}]}},"resource_changes":[{"address":"aws_iam_policy.AssumeRole_passes","mode":"managed","type":"aws_iam_policy","name":"AssumeRole_passes","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Assume roles don't need a account condition","name":"AssumeRole_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"after_unknown":{"arn":true,"id":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_policy.not_a_service_prinicpal_passes","mode":"managed","type":"aws_iam_policy","name":"not_a_service_prinicpal_passes","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Passes without a service principal","name":"not_a_service_prinicpal_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"AWS\": [\n          \"555555555555\",\n          \"123456789012\"\n        ]\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"after_unknown":{"arn":true,"id":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_policy.s3_service_principal_fails","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_fails","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Fails without an account condition","name":"Service_principal_fails","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"after_unknown":{"arn":true,"id":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_policy.s3_service_principal_passes","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_passes","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Passes with an account condition","name":"Service_principal_passes","name_prefix":null,"path":"/","policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"AWS:SourceAccount\": \"account\"\n        }\n      }\n    }\n  ]\n}","tags":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"},"tags_all":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}},"after_unknown":{"arn":true,"id":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_role.iam_for_lambda","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"iam_for_lambda","path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"aws_iam_role.iam_for_lambda_with_eni","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda_with_eni","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"iam_for_lambda_with_eni","path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"aws_iam_role_policy_attachment.lambda","mode":"managed","type":"aws_iam_role_policy_attachment","name":"lambda","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole","role":"iam_for_lambda_with_eni"},"after_unknown":{"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_lambda_function.test_lambda_with_bad_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_bad_runtime","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_lambda_with_bad_runtime","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs10.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[]},"after_unknown":{"architectures":true,"arn":true,"dead_letter_config":[],"environment":[],"file_system_config":[],"id":true,"image_config":[],"invoke_arn":true,"last_modified":true,"qualified_arn":true,"role":true,"signing_job_arn":true,"signing_profile_version_arn":true,"source_code_size":true,"tags_all":true,"tracing_config":true,"version":true,"vpc_config":[]},"before_sensitive":false,"after_sensitive":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[]}}},{"address":"aws_lambda_function.test_lambda_with_good_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_good_runtime","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_lambda_with_good_runtime","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[]},"after_unknown":{"architectures":true,"arn":true,"dead_letter_config":[],"environment":[],"file_system_config":[],"id":true,"image_config":[],"invoke_arn":true,"last_modified":true,"qualified_arn":true,"role":true,"signing_job_arn":true,"signing_profile_version_arn":true,"source_code_size":true,"tags_all":true,"tracing_config":true,"version":true,"vpc_config":[]},"before_sensitive":false,"after_sensitive":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[]}}},{"address":"aws_lambda_function.test_vpc_lambda_with_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_eni_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_vpc_lambda_with_eni_policy","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[{"security_group_ids":null,"subnet_ids":null}]},"after_unknown":{"architectures":true,"arn":true,"dead_letter_config":[],"environment":[],"file_system_config":[],"id":true,"image_config":[],"invoke_arn":true,"last_modified":true,"qualified_arn":true,"role":true,"signing_job_arn":true,"signing_profile_version_arn":true,"source_code_size":true,"tags_all":true,"tracing_config":true,"version":true,"vpc_config":[{"vpc_id":true}]},"before_sensitive":false,"after_sensitive":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[{}]}}},{"address":"aws_lambda_function.test_vpc_lambda_with_missing_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_missing_eni_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"code_signing_config_arn":null,"dead_letter_config":[],"description":null,"environment":[],"file_system_config":[],"filename":"mocks/test.zip","function_name":"test_vpc_lambda_with_missing_eni_policy","handler":"index.test","image_config":[],"image_uri":null,"kms_key_arn":null,"layers":null,"memory_size":128,"package_type":"Zip","publish":false,"reserved_concurrent_executions":-1,"runtime":"nodejs12.x","s3_bucket":null,"s3_key":null,"s3_object_version":null,"source_code_hash":"55O3slT2emNC41dVY7jnD4xLKHt0tS8mpR1lV8vQHws=","tags":null,"timeout":3,"timeouts":null,"vpc_config":[{"security_group_ids":null,"subnet_ids":null}]},"after_unknown":{"architectures":true,"arn":true,"dead_letter_config":[],"environment":[],"file_system_config":[],"id":true,"image_config":[],"invoke_arn":true,"last_modified":true,"qualified_arn":true,"role":true,"signing_job_arn":true,"signing_profile_version_arn":true,"source_code_size":true,"tags_all":true,"tracing_config":true,"version":true,"vpc_config":[{"vpc_id":true}]},"before_sensitive":false,"after_sensitive":{"architectures":[],"dead_letter_config":[],"environment":[],"file_system_config":[],"image_config":[],"tags_all":{},"tracing_config":[],"vpc_config":[{}]}}},{"address":"aws_security_group.bad_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"bad_ports_for_protocol","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":443}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":443}],"name":"bad_ports_for_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"aws_security_group.good_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"good_ports_for_protocol","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"name":"good_ports_for_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"aws_security_group.tcp_protocol","mode":"managed","type":"aws_security_group","name":"tcp_protocol","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Managed by Terraform","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443}],"name":"tcp_protocol","revoke_rules_on_delete":false,"tags":{"CostCentre":"tf-test-sg","Terraform":"test"},"tags_all":{"CostCentre":"tf-test-sg","Terraform":"test"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_cloudwatch_log_group.proxy","module_address":"module.rds","mode":"managed","type":"aws_cloudwatch_log_group","name":"proxy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"kms_key_id":null,"name":"/aws/rds/proxy/test-rds-proxy","name_prefix":null,"retention_in_days":14,"tags":{"CostCentre":"cal","Name":"test-rds_proxy_logs","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds_proxy_logs","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_db_proxy.proxy","module_address":"module.rds","mode":"managed","type":"aws_db_proxy","name":"proxy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"auth":[{"auth_scheme":"SECRETS","description":"The database connection string","iam_auth":"DISABLED"}],"debug_logging":false,"engine_family":"POSTGRESQL","idle_client_timeout":1800,"name":"test-rds-proxy","require_tls":true,"tags":{"CostCentre":"cal","Name":"test-rds-rds-proxy","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-rds-proxy","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"auth":[{"secret_arn":true}],"endpoint":true,"id":true,"role_arn":true,"tags":{},"tags_all":{},"vpc_security_group_ids":true,"vpc_subnet_ids":true},"before_sensitive":false,"after_sensitive":{"auth":[{}],"tags":{},"tags_all":{},"vpc_security_group_ids":[],"vpc_subnet_ids":[]}}},{"address":"module.rds.aws_db_proxy_default_target_group.this","module_address":"module.rds","mode":"managed","type":"aws_db_proxy_default_target_group","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"db_proxy_name":"test-rds-proxy","timeouts":null},"after_unknown":{"arn":true,"connection_pool_config":true,"id":true,"name":true},"before_sensitive":false,"after_sensitive":{"connection_pool_config":[]}}},{"address":"module.rds.aws_db_proxy_target.target","module_address":"module.rds","mode":"managed","type":"aws_db_proxy_target","name":"target","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"db_instance_identifier":null,"db_proxy_name":"test-rds-proxy"},"after_unknown":{"db_cluster_identifier":true,"endpoint":true,"id":true,"port":true,"rds_resource_id":true,"target_arn":true,"target_group_name":true,"tracked_cluster_id":true,"type":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.rds.aws_db_subnet_group.rds","module_address":"module.rds","mode":"managed","type":"aws_db_subnet_group","name":"rds","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Managed by Terraform","name":"test-rds-subnet-group","tags":{"CostCentre":"cal","Name":"test-rds-subnet-group","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-subnet-group","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name_prefix":true,"subnet_ids":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"subnet_ids":[],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_iam_policy.read_connection_string","module_address":"module.rds","mode":"managed","type":"aws_iam_policy","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"name":"test-rdsReadConnectionString","name_prefix":null,"path":"/","tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"policy":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_iam_role.rds_proxy","module_address":"module.rds","mode":"managed","type":"aws_iam_role","name":"rds_proxy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"RDSAssume\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"rds.amazonaws.com\"\n      }\n    }\n  ]\n}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"test-rds_rds_proxy","path":"/","permissions_boundary":null,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags":{},"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_iam_role_policy_attachment.read_connection_string","module_address":"module.rds","mode":"managed","type":"aws_iam_role_policy_attachment","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"test-rds_rds_proxy"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.rds.aws_rds_cluster.cluster","module_address":"module.rds","mode":"managed","type":"aws_rds_cluster","name":"cluster","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allow_major_version_upgrade":false,"backtrack_window":null,"backup_retention_period":7,"cluster_identifier":"test-rds-cluster","copy_tags_to_snapshot":false,"database_name":"foo","db_instance_parameter_group_name":null,"db_subnet_group_name":"test-rds-subnet-group","deletion_protection":true,"enable_global_write_forwarding":false,"enable_http_endpoint":false,"enabled_cloudwatch_logs_exports":null,"engine":"aurora-postgresql","engine_mode":"provisioned","engine_version":"13.3","global_cluster_identifier":null,"iam_database_authentication_enabled":null,"master_password":"foo","master_username":"calvin","preferred_backup_window":"07:00-09:00","replication_source_identifier":null,"restore_to_point_in_time":[],"s3_import":[],"scaling_configuration":[],"skip_final_snapshot":false,"snapshot_identifier":null,"source_region":null,"storage_encrypted":true,"tags":{"CostCentre":"cal","Name":"test-rds-cluster","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-cluster","Terraform":"true"},"timeouts":null},"after_unknown":{"apply_immediately":true,"arn":true,"availability_zones":true,"cluster_identifier_prefix":true,"cluster_members":true,"cluster_resource_id":true,"db_cluster_parameter_group_name":true,"endpoint":true,"engine_version_actual":true,"final_snapshot_identifier":true,"hosted_zone_id":true,"iam_roles":true,"id":true,"kms_key_id":true,"port":true,"preferred_maintenance_window":true,"reader_endpoint":true,"restore_to_point_in_time":[],"s3_import":[],"scaling_configuration":[],"tags":{},"tags_all":{},"vpc_security_group_ids":true},"before_sensitive":false,"after_sensitive":{"availability_zones":[],"cluster_members":[],"iam_roles":[],"master_password":true,"restore_to_point_in_time":[],"s3_import":[],"scaling_configuration":[],"tags":{},"tags_all":{},"vpc_security_group_ids":[]}}},{"address":"module.rds.aws_rds_cluster_instance.instances[0]","module_address":"module.rds","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-0","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-0","Terraform":"true"},"timeouts":null},"after_unknown":{"apply_immediately":true,"arn":true,"availability_zone":true,"ca_cert_identifier":true,"cluster_identifier":true,"db_parameter_group_name":true,"dbi_resource_id":true,"endpoint":true,"engine_version_actual":true,"id":true,"identifier_prefix":true,"kms_key_id":true,"monitoring_role_arn":true,"performance_insights_kms_key_id":true,"performance_insights_retention_period":true,"port":true,"preferred_backup_window":true,"preferred_maintenance_window":true,"storage_encrypted":true,"tags":{},"tags_all":{},"writer":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_rds_cluster_instance.instances[1]","module_address":"module.rds","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-1","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-1","Terraform":"true"},"timeouts":null},"after_unknown":{"apply_immediately":true,"arn":true,"availability_zone":true,"ca_cert_identifier":true,"cluster_identifier":true,"db_parameter_group_name":true,"dbi_resource_id":true,"endpoint":true,"engine_version_actual":true,"id":true,"identifier_prefix":true,"kms_key_id":true,"monitoring_role_arn":true,"performance_insights_kms_key_id":true,"performance_insights_retention_period":true,"port":true,"preferred_backup_window":true,"preferred_maintenance_window":true,"storage_encrypted":true,"tags":{},"tags_all":{},"writer":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_rds_cluster_instance.instances[2]","module_address":"module.rds","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"auto_minor_version_upgrade":true,"copy_tags_to_snapshot":false,"db_subnet_group_name":"test-rds-subnet-group","engine":"aurora-postgresql","engine_version":"13.3","identifier":"test-rds-instance-2","instance_class":"db.t3.medium","monitoring_interval":0,"performance_insights_enabled":true,"promotion_tier":0,"publicly_accessible":false,"tags":{"CostCentre":"cal","Name":"test-rds-instance-2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds-instance-2","Terraform":"true"},"timeouts":null},"after_unknown":{"apply_immediately":true,"arn":true,"availability_zone":true,"ca_cert_identifier":true,"cluster_identifier":true,"db_parameter_group_name":true,"dbi_resource_id":true,"endpoint":true,"engine_version_actual":true,"id":true,"identifier_prefix":true,"kms_key_id":true,"monitoring_role_arn":true,"performance_insights_kms_key_id":true,"performance_insights_retention_period":true,"port":true,"preferred_backup_window":true,"preferred_maintenance_window":true,"storage_encrypted":true,"tags":{},"tags_all":{},"writer":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_secretsmanager_secret.connection_string","module_address":"module.rds","mode":"managed","type":"aws_secretsmanager_secret","name":"connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"force_overwrite_replica_secret":false,"kms_key_id":null,"recovery_window_in_days":30,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name":true,"name_prefix":true,"policy":true,"replica":true,"rotation_enabled":true,"rotation_lambda_arn":true,"rotation_rules":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"replica":[],"rotation_rules":[],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_secretsmanager_secret.proxy_connection_string","module_address":"module.rds","mode":"managed","type":"aws_secretsmanager_secret","name":"proxy_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"force_overwrite_replica_secret":false,"kms_key_id":null,"recovery_window_in_days":30,"tags":{"CostCentre":"cal","Terraform":"true"},"tags_all":{"CostCentre":"cal","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"name":true,"name_prefix":true,"policy":true,"replica":true,"rotation_enabled":true,"rotation_lambda_arn":true,"rotation_rules":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"replica":[],"rotation_rules":[],"tags":{},"tags_all":{}}}},{"address":"module.rds.aws_secretsmanager_secret_version.connection_string","module_address":"module.rds","mode":"managed","type":"aws_secretsmanager_secret_version","name":"connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"secret_binary":null,"secret_string":"{\"password\":\"foo\",\"username\":\"calvin\"}"},"after_unknown":{"arn":true,"id":true,"secret_id":true,"version_id":true,"version_stages":true},"before_sensitive":false,"after_sensitive":{"secret_binary":true,"secret_string":true,"version_stages":[]}}},{"address":"module.rds.aws_secretsmanager_secret_version.proxy_connection_string","module_address":"module.rds","mode":"managed","type":"aws_secretsmanager_secret_version","name":"proxy_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"secret_binary":null},"after_unknown":{"arn":true,"id":true,"secret_id":true,"secret_string":true,"version_id":true,"version_stages":true},"before_sensitive":false,"after_sensitive":{"secret_binary":true,"secret_string":true,"version_stages":[]}}},{"address":"module.rds.aws_security_group.rds_proxy","module_address":"module.rds","mode":"managed","type":"aws_security_group","name":"rds_proxy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"The Security group that allows communication between the proxy and the database","egress":[{"cidr_blocks":[],"description":"","from_port":5432,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":true,"to_port":5432}],"ingress":[{"cidr_blocks":[],"description":"","from_port":5432,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":true,"to_port":5432}],"name":"test-rds_rds_proxy_sg","revoke_rules_on_delete":false,"tags":{"CostCentre":"cal","Name":"test-rds_rds_proxy_sg","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"test-rds_rds_proxy_sg","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"module.rds.data.aws_iam_policy_document.read_connection_string","module_address":"module.rds","mode":"data","type":"aws_iam_policy_document","name":"read_connection_string","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["secretsmanager:DescribeSecret","secretsmanager:GetResourcePolicy","secretsmanager:GetSecretValue","secretsmanager:ListSecretVersionIds"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":[],"sid":"0"},{"actions":["secretsmanager:ListSecrets"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"1"},{"actions":["kms:Decrypt"],"condition":[{"test":"StringEquals","values":["secretsmanager.ca-central-1.amazonaws.com"],"variable":"kms:ViaService"}],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"2"}],"version":null},"after_unknown":{"id":true,"json":true,"statement":[{"actions":[false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[true]},{"actions":[false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[{"values":[false]}],"not_principals":[],"principals":[],"resources":[false]}]},"before_sensitive":false,"after_sensitive":{"statement":[{"actions":[false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[{"values":[false]}],"not_principals":[],"principals":[],"resources":[false]}]}}},{"address":"module.rds.random_string.random","module_address":"module.rds","mode":"managed","type":"random_string","name":"random","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"keepers":null,"length":6,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"override_special":null,"special":false,"upper":false},"after_unknown":{"id":true,"result":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_default_network_acl.default","module_address":"module.vpc","mode":"managed","type":"aws_default_network_acl","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"egress":[],"ingress":[],"subnet_ids":null,"tags":{"CostCentre":"cal","Name":"vpc_default_nacl","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_default_nacl","Terraform":"true"}},"after_unknown":{"arn":true,"default_network_acl_id":true,"egress":[],"id":true,"ingress":[],"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[],"ingress":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_default_route_table.default","module_address":"module.vpc","mode":"managed","type":"aws_default_route_table","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"propagating_vgws":null,"route":[],"tags":{"CostCentre":"cal","Terraform":"true","name":"vpc_default_route_table"},"tags_all":{"CostCentre":"cal","Terraform":"true","name":"vpc_default_route_table"},"timeouts":null},"after_unknown":{"arn":true,"default_route_table_id":true,"id":true,"owner_id":true,"route":[],"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_default_security_group.default","module_address":"module.vpc","mode":"managed","type":"aws_default_security_group","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"revoke_rules_on_delete":false,"tags":{"CostCentre":"cal","Name":"vpc_default_sg","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_default_sg","Terraform":"true"}},"after_unknown":{"arn":true,"description":true,"egress":true,"id":true,"ingress":true,"name":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[],"ingress":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_internet_gateway.gw","module_address":"module.vpc","mode":"managed","type":"aws_internet_gateway","name":"gw","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_internet_gateway","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_internet_gateway","Terraform":"true"}},"after_unknown":{"arn":true,"id":true,"owner_id":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[0]","module_address":"module.vpc","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-0","Terraform":"true"}},"after_unknown":{"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[1]","module_address":"module.vpc","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-1","Terraform":"true"}},"after_unknown":{"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_nat_gateway.nat_gw[2]","module_address":"module.vpc","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"allocation_id":"","connectivity_type":"private","tags":{"CostCentre":"cal","Name":"vpc-natgw-2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc-natgw-2","Terraform":"true"}},"after_unknown":{"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_network_acl.main","module_address":"module.vpc","mode":"managed","type":"aws_network_acl","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_main_nacl","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_main_nacl","Terraform":"true"}},"after_unknown":{"arn":true,"egress":true,"id":true,"ingress":true,"owner_id":true,"subnet_ids":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[],"ingress":[],"subnet_ids":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_network_acl_rule.block_rdp[0]","module_address":"module.vpc","mode":"managed","type":"aws_network_acl_rule","name":"block_rdp","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"cidr_block":"10.0.0.0/16","egress":false,"from_port":3389,"icmp_code":null,"icmp_type":null,"ipv6_cidr_block":null,"protocol":"tcp","rule_action":"deny","rule_number":51,"to_port":3389},"after_unknown":{"id":true,"network_acl_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_network_acl_rule.block_ssh[0]","module_address":"module.vpc","mode":"managed","type":"aws_network_acl_rule","name":"block_ssh","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"cidr_block":"10.0.0.0/16","egress":false,"from_port":22,"icmp_code":null,"icmp_type":null,"ipv6_cidr_block":null,"protocol":"tcp","rule_action":"deny","rule_number":50,"to_port":22},"after_unknown":{"id":true,"network_acl_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route.private_nat_gateway[0]","module_address":"module.vpc","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true,"timeouts":{}},"before_sensitive":false,"after_sensitive":{"timeouts":{}}}},{"address":"module.vpc.aws_route.private_nat_gateway[1]","module_address":"module.vpc","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true,"timeouts":{}},"before_sensitive":false,"after_sensitive":{"timeouts":{}}}},{"address":"module.vpc.aws_route.private_nat_gateway[2]","module_address":"module.vpc","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true,"timeouts":{}},"before_sensitive":false,"after_sensitive":{"timeouts":{}}}},{"address":"module.vpc.aws_route.public_internet_gateway","module_address":"module.vpc","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"local_gateway_id":null,"nat_gateway_id":null,"timeouts":{"create":"5m","delete":null,"update":null},"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true,"timeouts":{}},"before_sensitive":false,"after_sensitive":{"timeouts":{}}}},{"address":"module.vpc.aws_route_table.private[0]","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_0","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_0","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table.private[1]","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_1","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_1","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table.private[2]","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_private_route_table_2","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_route_table_2","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table.public","module_address":"module.vpc","mode":"managed","type":"aws_route_table","name":"public","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"CostCentre":"cal","Name":"vpc_public_route_table","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_route_table","Terraform":"true"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_route_table_association.private[0]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.private[1]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.private[2]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.public[0]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.public[1]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_route_table_association.public[2]","module_address":"module.vpc","mode":"managed","type":"aws_route_table_association","name":"public","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_subnet.private[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1a","cidr_block":"10.0.0.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1a","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1a","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"timeouts":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{},"timeouts":{}}}},{"address":"module.vpc.aws_subnet.private[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1b","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1b","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1b","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"timeouts":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{},"timeouts":{}}}},{"address":"module.vpc.aws_subnet.private[2]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"private","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1d","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1d","Terraform":"true","Tier":"Private"},"tags_all":{"CostCentre":"cal","Name":"vpc_private_subnet_ca-central-1d","Terraform":"true","Tier":"Private"},"timeouts":{"create":null,"delete":"40m"}},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"timeouts":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{},"timeouts":{}}}},{"address":"module.vpc.aws_subnet.public[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1a","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1a","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1a","Terraform":"true","Tier":"Public"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.public[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1b","cidr_block":"10.0.4.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1b","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1b","Terraform":"true","Tier":"Public"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.public[2]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"public","index":2,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"ca-central-1d","cidr_block":"10.0.5.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1d","Terraform":"true","Tier":"Public"},"tags_all":{"CostCentre":"cal","Name":"vpc_public_subnet_ca-central-1d","Terraform":"true","Tier":"Public"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_vpc.main","module_address":"module.vpc","mode":"managed","type":"aws_vpc","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null,"tags":{"CostCentre":"cal","Name":"vpc_vpc","Terraform":"true"},"tags_all":{"CostCentre":"cal","Name":"vpc_vpc","Terraform":"true"}},"after_unknown":{"arn":true,"default_network_acl_id":true,"default_route_table_id":true,"default_security_group_id":true,"dhcp_options_id":true,"enable_classiclink":true,"enable_classiclink_dns_support":true,"id":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_network_border_group":true,"main_route_table_id":true,"owner_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}}],"prior_state":{"format_version":"0.2","terraform_version":"1.0.6","values":{"root_module":{"resources":[{"address":"data.aws_iam_policy_document.lambda_service_principal","mode":"data","type":"aws_iam_policy_document","name":"lambda_service_principal","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"3693445097","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      }\n    }\n  ]\n}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["sts:AssumeRole"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["lambda.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false]}],"resources":[]}]}},{"address":"data.aws_iam_policy_document.not_a_service_prinicpal","mode":"data","type":"aws_iam_policy_document","name":"not_a_service_prinicpal","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"3767598905","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"AWS\": [\n          \"555555555555\",\n          \"123456789012\"\n        ]\n      }\n    }\n  ]\n}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["kms:*"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["123456789012","555555555555"],"type":"AWS"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false,false]}],"resources":[]}]}},{"address":"data.aws_iam_policy_document.s3_service_principal","mode":"data","type":"aws_iam_policy_document","name":"s3_service_principal","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"4002550508","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      }\n    }\n  ]\n}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["kms:*"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["s3.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false]}],"resources":[]}]}},{"address":"data.aws_iam_policy_document.s3_service_principal_with_account","mode":"data","type":"aws_iam_policy_document","name":"s3_service_principal_with_account","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"4048715452","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"kms:*\",\n      \"Principal\": {\n        \"Service\": \"s3.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"AWS:SourceAccount\": \"account\"\n        }\n      }\n    }\n  ]\n}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["kms:*"],"condition":[{"test":"StringLike","values":["account"],"variable":"AWS:SourceAccount"}],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["s3.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[{"values":[false]}],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false]}],"resources":[]}]}}],"child_modules":[{"resources":[{"address":"module.rds.data.aws_iam_policy_document.assume_role","mode":"data","type":"aws_iam_policy_document","name":"assume_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"1301495841","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"RDSAssume\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"rds.amazonaws.com\"\n      }\n    }\n  ]\n}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["sts:AssumeRole"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["rds.amazonaws.com"],"type":"Service"}],"resources":[],"sid":"RDSAssume"}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false]}],"resources":[]}]}}],"address":"module.rds"},{"resources":[{"address":"module.vpc.data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"all_availability_zones":null,"exclude_names":null,"exclude_zone_ids":null,"filter":null,"group_names":["ca-central-1"],"id":"ca-central-1","names":["ca-central-1a","ca-central-1b","ca-central-1d"],"state":"available","zone_ids":["cac1-az1","cac1-az2","cac1-az4"]},"sensitive_values":{"group_names":[false],"names":[false,false,false],"zone_ids":[false,false,false]}}],"address":"module.vpc"}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","version_constraint":"~\u003e 3.37","expressions":{"region":{"constant_value":"ca-central-1"}}}},"root_module":{"resources":[{"address":"aws_iam_policy.AssumeRole_passes","mode":"managed","type":"aws_iam_policy","name":"AssumeRole_passes","provider_config_key":"aws","expressions":{"description":{"constant_value":"Assume roles don't need a account condition"},"name":{"constant_value":"AssumeRole_passes"},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.lambda_service_principal.json","data.aws_iam_policy_document.lambda_service_principal"]},"tags":{"constant_value":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}}},"schema_version":0},{"address":"aws_iam_policy.not_a_service_prinicpal_passes","mode":"managed","type":"aws_iam_policy","name":"not_a_service_prinicpal_passes","provider_config_key":"aws","expressions":{"description":{"constant_value":"Passes without a service principal"},"name":{"constant_value":"not_a_service_prinicpal_passes"},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.not_a_service_prinicpal.json","data.aws_iam_policy_document.not_a_service_prinicpal"]},"tags":{"constant_value":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}}},"schema_version":0},{"address":"aws_iam_policy.s3_service_principal_fails","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_fails","provider_config_key":"aws","expressions":{"description":{"constant_value":"Fails without an account condition"},"name":{"constant_value":"Service_principal_fails"},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.s3_service_principal.json","data.aws_iam_policy_document.s3_service_principal"]},"tags":{"constant_value":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}}},"schema_version":0},{"address":"aws_iam_policy.s3_service_principal_passes","mode":"managed","type":"aws_iam_policy","name":"s3_service_principal_passes","provider_config_key":"aws","expressions":{"description":{"constant_value":"Passes with an account condition"},"name":{"constant_value":"Service_principal_passes"},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.s3_service_principal_with_account.json","data.aws_iam_policy_document.s3_service_principal_with_account"]},"tags":{"constant_value":{"CostCentre":"tf-acc-test-iam-policy","Terraform":"test"}}},"schema_version":0},{"address":"aws_iam_role.iam_for_lambda","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda","provider_config_key":"aws","expressions":{"assume_role_policy":{"constant_value":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n"},"name":{"constant_value":"iam_for_lambda"}},"schema_version":0},{"address":"aws_iam_role.iam_for_lambda_with_eni","mode":"managed","type":"aws_iam_role","name":"iam_for_lambda_with_eni","provider_config_key":"aws","expressions":{"assume_role_policy":{"constant_value":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\n"},"name":{"constant_value":"iam_for_lambda_with_eni"}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.lambda","mode":"managed","type":"aws_iam_role_policy_attachment","name":"lambda","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"},"role":{"references":["aws_iam_role.iam_for_lambda_with_eni.name","aws_iam_role.iam_for_lambda_with_eni"]}},"schema_version":0},{"address":"aws_lambda_function.test_lambda_with_bad_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_bad_runtime","provider_config_key":"aws","expressions":{"filename":{"constant_value":"mocks/test.zip"},"function_name":{"constant_value":"test_lambda_with_bad_runtime"},"handler":{"constant_value":"index.test"},"role":{"references":["aws_iam_role.iam_for_lambda.arn","aws_iam_role.iam_for_lambda"]},"runtime":{"constant_value":"nodejs10.x"},"source_code_hash":{}},"schema_version":0},{"address":"aws_lambda_function.test_lambda_with_good_runtime","mode":"managed","type":"aws_lambda_function","name":"test_lambda_with_good_runtime","provider_config_key":"aws","expressions":{"filename":{"constant_value":"mocks/test.zip"},"function_name":{"constant_value":"test_lambda_with_good_runtime"},"handler":{"constant_value":"index.test"},"role":{"references":["aws_iam_role.iam_for_lambda.arn","aws_iam_role.iam_for_lambda"]},"runtime":{"constant_value":"nodejs12.x"},"source_code_hash":{}},"schema_version":0},{"address":"aws_lambda_function.test_vpc_lambda_with_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_eni_policy","provider_config_key":"aws","expressions":{"filename":{"constant_value":"mocks/test.zip"},"function_name":{"constant_value":"test_vpc_lambda_with_eni_policy"},"handler":{"constant_value":"index.test"},"role":{"references":["aws_iam_role.iam_for_lambda_with_eni.arn","aws_iam_role.iam_for_lambda_with_eni"]},"runtime":{"constant_value":"nodejs12.x"},"source_code_hash":{},"vpc_config":[{"security_group_ids":{"constant_value":[]},"subnet_ids":{"constant_value":[]}}]},"schema_version":0},{"address":"aws_lambda_function.test_vpc_lambda_with_missing_eni_policy","mode":"managed","type":"aws_lambda_function","name":"test_vpc_lambda_with_missing_eni_policy","provider_config_key":"aws","expressions":{"filename":{"constant_value":"mocks/test.zip"},"function_name":{"constant_value":"test_vpc_lambda_with_missing_eni_policy"},"handler":{"constant_value":"index.test"},"role":{"references":["aws_iam_role.iam_for_lambda.arn","aws_iam_role.iam_for_lambda"]},"runtime":{"constant_value":"nodejs12.x"},"source_code_hash":{},"vpc_config":[{"security_group_ids":{"constant_value":[]},"subnet_ids":{"constant_value":[]}}]},"schema_version":0},{"address":"aws_security_group.bad_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"bad_ports_for_protocol","provider_config_key":"aws","expressions":{"name":{"constant_value":"bad_ports_for_protocol"},"tags":{"constant_value":{"CostCentre":"tf-test-sg","Terraform":"test"}},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"schema_version":1},{"address":"aws_security_group.good_ports_for_protocol","mode":"managed","type":"aws_security_group","name":"good_ports_for_protocol","provider_config_key":"aws","expressions":{"name":{"constant_value":"good_ports_for_protocol"},"tags":{"constant_value":{"CostCentre":"tf-test-sg","Terraform":"test"}},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"schema_version":1},{"address":"aws_security_group.tcp_protocol","mode":"managed","type":"aws_security_group","name":"tcp_protocol","provider_config_key":"aws","expressions":{"name":{"constant_value":"tcp_protocol"},"tags":{"constant_value":{"CostCentre":"tf-test-sg","Terraform":"test"}},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"schema_version":1},{"address":"data.aws_iam_policy_document.lambda_service_principal","mode":"data","type":"aws_iam_policy_document","name":"lambda_service_principal","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["lambda.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0},{"address":"data.aws_iam_policy_document.not_a_service_prinicpal","mode":"data","type":"aws_iam_policy_document","name":"not_a_service_prinicpal","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["kms:*"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["123456789012","555555555555"]},"type":{"constant_value":"AWS"}}]}]},"schema_version":0},{"address":"data.aws_iam_policy_document.s3_service_principal","mode":"data","type":"aws_iam_policy_document","name":"s3_service_principal","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["kms:*"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["s3.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0},{"address":"data.aws_iam_policy_document.s3_service_principal_with_account","mode":"data","type":"aws_iam_policy_document","name":"s3_service_principal_with_account","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["kms:*"]},"condition":[{"test":{"constant_value":"StringLike"},"values":{"constant_value":["account"]},"variable":{"constant_value":"AWS:SourceAccount"}}],"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["s3.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0}],"module_calls":{"rds":{"source":"github.com/cds-snc/terraform-modules//rds","expressions":{"backup_retention_period":{"constant_value":7},"billing_tag_value":{"constant_value":"cal"},"database_name":{"constant_value":"foo"},"engine_version":{"constant_value":"13.3"},"name":{"constant_value":"test-rds"},"password":{"constant_value":"foo"},"preferred_backup_window":{"constant_value":"07:00-09:00"},"subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"username":{"constant_value":"calvin"},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"proxy_connection_string_arn":{"expression":{"references":["aws_secretsmanager_secret.proxy_connection_string.arn","aws_secretsmanager_secret.proxy_connection_string"]},"description":"The arn for the connectionstring to the RDS proxy"},"proxy_connection_string_value":{"sensitive":true,"expression":{"references":["aws_secretsmanager_secret_version.proxy_connection_string.secret_string","aws_secretsmanager_secret_version.proxy_connection_string"]}},"proxy_endpoint":{"expression":{"references":["aws_db_proxy.proxy.endpoint","aws_db_proxy.proxy"]}},"proxy_security_group_arn":{"expression":{"references":["aws_security_group.rds_proxy.arn","aws_security_group.rds_proxy"]}},"proxy_security_group_id":{"expression":{"references":["aws_security_group.rds_proxy.id","aws_security_group.rds_proxy"]}},"rds_cluster_id":{"expression":{"references":["aws_rds_cluster.cluster.id","aws_rds_cluster.cluster"]},"description":"The ID of the RDS cluster"}},"resources":[{"address":"aws_cloudwatch_log_group.proxy","mode":"managed","type":"aws_cloudwatch_log_group","name":"proxy","provider_config_key":"rds:aws","expressions":{"name":{"references":["local.proxy_name"]},"retention_in_days":{"references":["var.proxy_log_retention_in_days"]},"tags":{"references":["local.common_tags","var.name"]}},"schema_version":0},{"address":"aws_db_proxy.proxy","mode":"managed","type":"aws_db_proxy","name":"proxy","provider_config_key":"rds:aws","expressions":{"auth":[{"auth_scheme":{"constant_value":"SECRETS"},"description":{"constant_value":"The database connection string"},"iam_auth":{"constant_value":"DISABLED"},"secret_arn":{"references":["aws_secretsmanager_secret.connection_string.arn","aws_secretsmanager_secret.connection_string"]}}],"debug_logging":{"references":["var.proxy_debug_logging"]},"engine_family":{"references":["local.engine_family"]},"idle_client_timeout":{"constant_value":1800},"name":{"references":["local.proxy_name"]},"require_tls":{"constant_value":true},"role_arn":{"references":["aws_iam_role.rds_proxy.arn","aws_iam_role.rds_proxy"]},"tags":{"references":["local.common_tags","var.name"]},"vpc_security_group_ids":{"references":["aws_security_group.rds_proxy.id","aws_security_group.rds_proxy"]},"vpc_subnet_ids":{"references":["var.subnet_ids"]}},"schema_version":0},{"address":"aws_db_proxy_default_target_group.this","mode":"managed","type":"aws_db_proxy_default_target_group","name":"this","provider_config_key":"rds:aws","expressions":{"db_proxy_name":{"references":["aws_db_proxy.proxy.name","aws_db_proxy.proxy"]}},"schema_version":0},{"address":"aws_db_proxy_target.target","mode":"managed","type":"aws_db_proxy_target","name":"target","provider_config_key":"rds:aws","expressions":{"db_cluster_identifier":{"references":["aws_rds_cluster.cluster.id","aws_rds_cluster.cluster"]},"db_proxy_name":{"references":["aws_db_proxy.proxy.name","aws_db_proxy.proxy"]},"target_group_name":{"references":["aws_db_proxy_default_target_group.this.name","aws_db_proxy_default_target_group.this"]}},"schema_version":0},{"address":"aws_db_subnet_group.rds","mode":"managed","type":"aws_db_subnet_group","name":"rds","provider_config_key":"rds:aws","expressions":{"name":{"references":["var.name"]},"subnet_ids":{"references":["var.subnet_ids"]},"tags":{"references":["local.common_tags","var.name"]}},"schema_version":0},{"address":"aws_iam_policy.read_connection_string","mode":"managed","type":"aws_iam_policy","name":"read_connection_string","provider_config_key":"rds:aws","expressions":{"name":{"references":["var.name"]},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.read_connection_string.json","data.aws_iam_policy_document.read_connection_string"]},"tags":{"references":["local.common_tags"]}},"schema_version":0},{"address":"aws_iam_role.rds_proxy","mode":"managed","type":"aws_iam_role","name":"rds_proxy","provider_config_key":"rds:aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.assume_role.json","data.aws_iam_policy_document.assume_role"]},"name":{"references":["var.name"]},"tags":{"references":["local.common_tags"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.read_connection_string","mode":"managed","type":"aws_iam_role_policy_attachment","name":"read_connection_string","provider_config_key":"rds:aws","expressions":{"policy_arn":{"references":["aws_iam_policy.read_connection_string.arn","aws_iam_policy.read_connection_string"]},"role":{"references":["aws_iam_role.rds_proxy.name","aws_iam_role.rds_proxy"]}},"schema_version":0},{"address":"aws_rds_cluster.cluster","mode":"managed","type":"aws_rds_cluster","name":"cluster","provider_config_key":"rds:aws","expressions":{"allow_major_version_upgrade":{"references":["var.allow_major_version_upgrade"]},"backup_retention_period":{"references":["var.backup_retention_period"]},"cluster_identifier":{"references":["var.name"]},"database_name":{"references":["var.database_name"]},"db_subnet_group_name":{"references":["aws_db_subnet_group.rds.name","aws_db_subnet_group.rds"]},"deletion_protection":{"references":["var.prevent_cluster_deletion"]},"engine":{"references":["var.engine"]},"engine_version":{"references":["var.engine_version"]},"final_snapshot_identifier":{"references":["var.name","random_string.random.result","random_string.random"]},"master_password":{"references":["var.password"]},"master_username":{"references":["var.username"]},"preferred_backup_window":{"references":["var.preferred_backup_window"]},"skip_final_snapshot":{"references":["var.skip_final_snapshot"]},"storage_encrypted":{"constant_value":true},"tags":{"references":["local.common_tags","var.name"]},"vpc_security_group_ids":{"references":["aws_security_group.rds_proxy.id","aws_security_group.rds_proxy"]}},"schema_version":0},{"address":"aws_rds_cluster_instance.instances","mode":"managed","type":"aws_rds_cluster_instance","name":"instances","provider_config_key":"rds:aws","expressions":{"cluster_identifier":{"references":["aws_rds_cluster.cluster.id","aws_rds_cluster.cluster"]},"db_subnet_group_name":{"references":["aws_db_subnet_group.rds.name","aws_db_subnet_group.rds"]},"engine":{"references":["var.engine"]},"engine_version":{"references":["var.engine_version"]},"identifier":{"references":["var.name","count.index"]},"instance_class":{"references":["var.instance_class"]},"performance_insights_enabled":{"references":["var.performance_insights_enabled"]},"tags":{"references":["local.common_tags","var.name","count.index"]}},"schema_version":0,"count_expression":{"references":["var.instances"]}},{"address":"aws_secretsmanager_secret.connection_string","mode":"managed","type":"aws_secretsmanager_secret","name":"connection_string","provider_config_key":"rds:aws","expressions":{"name":{"references":["var.name","random_string.random.result","random_string.random"]},"tags":{"references":["local.common_tags"]}},"schema_version":0},{"address":"aws_secretsmanager_secret.proxy_connection_string","mode":"managed","type":"aws_secretsmanager_secret","name":"proxy_connection_string","provider_config_key":"rds:aws","expressions":{"name":{"references":["var.name","random_string.random.result","random_string.random"]},"tags":{"references":["local.common_tags"]}},"schema_version":0},{"address":"aws_secretsmanager_secret_version.connection_string","mode":"managed","type":"aws_secretsmanager_secret_version","name":"connection_string","provider_config_key":"rds:aws","expressions":{"secret_id":{"references":["aws_secretsmanager_secret.connection_string.id","aws_secretsmanager_secret.connection_string"]},"secret_string":{"references":["var.username","var.password"]}},"schema_version":0},{"address":"aws_secretsmanager_secret_version.proxy_connection_string","mode":"managed","type":"aws_secretsmanager_secret_version","name":"proxy_connection_string","provider_config_key":"rds:aws","expressions":{"secret_id":{"references":["aws_secretsmanager_secret.proxy_connection_string.id","aws_secretsmanager_secret.proxy_connection_string"]},"secret_string":{"references":["local.is_mysql","aws_db_proxy.proxy.endpoint","aws_db_proxy.proxy","var.database_name","var.username","var.password","var.username","var.password","aws_db_proxy.proxy.endpoint","aws_db_proxy.proxy","var.database_name"]}},"schema_version":0},{"address":"aws_security_group.rds_proxy","mode":"managed","type":"aws_security_group","name":"rds_proxy","provider_config_key":"rds:aws","expressions":{"description":{"constant_value":"The Security group that allows communication between the proxy and the database"},"name":{"references":["var.name"]},"tags":{"references":["local.common_tags","var.name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1},{"address":"random_string.random","mode":"managed","type":"random_string","name":"random","provider_config_key":"rds:random","expressions":{"length":{"constant_value":6},"special":{"constant_value":false},"upper":{"constant_value":false}},"schema_version":1},{"address":"data.aws_iam_policy_document.assume_role","mode":"data","type":"aws_iam_policy_document","name":"assume_role","provider_config_key":"rds:aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["rds.amazonaws.com"]},"type":{"constant_value":"Service"}}],"sid":{"constant_value":"RDSAssume"}}]},"schema_version":0},{"address":"data.aws_iam_policy_document.read_connection_string","mode":"data","type":"aws_iam_policy_document","name":"read_connection_string","provider_config_key":"rds:aws","expressions":{"statement":[{"actions":{"constant_value":["secretsmanager:GetResourcePolicy","secretsmanager:GetSecretValue","secretsmanager:DescribeSecret","secretsmanager:ListSecretVersionIds"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_secretsmanager_secret.connection_string.arn","aws_secretsmanager_secret.connection_string"]},"sid":{"constant_value":0}},{"actions":{"constant_value":["secretsmanager:ListSecrets"]},"effect":{"constant_value":"Allow"},"resources":{"constant_value":["*"]},"sid":{"constant_value":1}},{"actions":{"constant_value":["kms:Decrypt"]},"condition":[{"test":{"constant_value":"StringEquals"},"values":{"constant_value":["secretsmanager.ca-central-1.amazonaws.com"]},"variable":{"constant_value":"kms:ViaService"}}],"effect":{"constant_value":"Allow"},"resources":{"constant_value":["*"]},"sid":{"constant_value":2}}]},"schema_version":0}],"variables":{"allow_major_version_upgrade":{"default":false,"description":"(Optional, default 'false') This flag allows RDS to perform a major engine upgrade. \u003cbr/\u003e **Please Note:** This could break things so make sure you know that your code is compatible with the new features in this version."},"backup_retention_period":{"description":"(Required) The amount of days to keep backups for."},"billing_tag_key":{"default":"CostCentre","description":"(Optional, default 'CostCentre') The name of the billing tag"},"billing_tag_value":{"description":"(Required) The value of the billing tag"},"database_name":{"description":"(Required) The name of the database to be created inside the cluster."},"engine":{"default":"aurora-postgresql","description":"(Optional, defaults 'aurora-postgresql') The database engine to use. Valid values are 'aurora-postgresql' and 'aurora-mysql'"},"engine_version":{"description":"(Required) The database version to use. Engine version is contingent on instance_class see [this list of supported combinations](https://docs.amazonaws.cn/en_us/AmazonRDS/latest/AuroraUserGuide/Concepts.DBInstanceClass.html#Concepts.DBInstanceClass.SupportAurora)"},"instance_class":{"default":"db.t3.medium","description":"(Optional, default 'db.t3.medium') The type of EC2 instance to run this on."},"instances":{"default":3,"description":"(Optional, default '3') The number of RDS Cluster instances to create, defaults to HA mode."},"name":{"description":"(Required) The name of the db also used for other identifiers"},"password":{"description":"(Required) The password for the admin user for the db","sensitive":true},"performance_insights_enabled":{"default":true,"description":"(Optional, default 'true') This flag enables performance insights for the RDS cluster instances."},"preferred_backup_window":{"description":"(Required) The time you want your DB to be backedup. Takes the format `\"07:00-09:00\"`"},"prevent_cluster_deletion":{"default":true,"description":"(Optional, default 'true') This flag prevents deletion of the RDS cluster. \u003cbr/\u003e **Please Note:** We cannot prevent deletion of RDS instances in the module, we recommend you add `lifecycle { prevent_deletion = true }` to the module to prevent instance deletion"},"proxy_debug_logging":{"default":false,"description":"(Optional, default 'false') Allows the proxy to log debug information. \u003cbr/\u003e **Please Note:** This will include all sql commands and potential sensitive information"},"proxy_log_retention_in_days":{"default":14,"description":"(Optional, default '14') The number of days to retain the proxy logs in cloudwatch"},"skip_final_snapshot":{"default":false,"description":"(Optional, default 'false') This flag determines if a final database snapshot it taken before the cluster is deleted."},"subnet_ids":{"description":"(Required) The name of the subnet the DB has to stay in"},"username":{"description":"(Required) The username for the admin user for the db"},"vpc_id":{"description":"(Required) The vpc to run the cluster and related infrastructure in"}}}},"vpc":{"source":"github.com/cds-snc/terraform-modules//vpc","expressions":{"billing_tag_value":{"constant_value":"cal"},"enable_eip":{"constant_value":false},"high_availability":{"constant_value":true},"name":{"constant_value":"vpc"}},"module":{"outputs":{"cidr_block":{"expression":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]}},"main_nacl_id":{"expression":{"references":["aws_network_acl.main.id","aws_network_acl.main"]}},"main_route_table_id":{"expression":{"references":["aws_vpc.main.main_route_table_id","aws_vpc.main"]}},"private_route_table_ids":{"expression":{"references":["aws_route_table.private"]}},"private_subnet_ids":{"expression":{"references":["aws_subnet.private"]}},"public_ips":{"expression":{"references":["aws_eip.nat"]}},"public_subnet_ids":{"expression":{"references":["aws_subnet.public"]}},"vpc_id":{"expression":{"references":["aws_vpc.main.id","aws_vpc.main"]}}},"resources":[{"address":"aws_cloudwatch_log_group.flow_logs","mode":"managed","type":"aws_cloudwatch_log_group","name":"flow_logs","provider_config_key":"vpc:aws","expressions":{"name":{"references":["var.name"]},"retention_in_days":{"constant_value":30},"tags":{"references":["local.common_tags"]}},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"aws_default_network_acl.default","mode":"managed","type":"aws_default_network_acl","name":"default","provider_config_key":"vpc:aws","expressions":{"default_network_acl_id":{"references":["aws_vpc.main.default_network_acl_id","aws_vpc.main"]},"tags":{"references":["local.common_tags","var.name"]}},"schema_version":0},{"address":"aws_default_route_table.default","mode":"managed","type":"aws_default_route_table","name":"default","provider_config_key":"vpc:aws","expressions":{"default_route_table_id":{"references":["aws_vpc.main.default_route_table_id","aws_vpc.main"]},"route":{"constant_value":[]},"tags":{"references":["local.common_tags","var.name"]}},"schema_version":0},{"address":"aws_default_security_group.default","mode":"managed","type":"aws_default_security_group","name":"default","provider_config_key":"vpc:aws","expressions":{"tags":{"references":["local.common_tags","var.name"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":1},{"address":"aws_eip.nat","mode":"managed","type":"aws_eip","name":"nat","provider_config_key":"vpc:aws","expressions":{"tags":{"references":["local.common_tags","var.name","count.index"]},"vpc":{"constant_value":true}},"schema_version":0,"count_expression":{"references":["var.enable_eip","local.max_subnet_length"]}},{"address":"aws_flow_log.flow_logs","mode":"managed","type":"aws_flow_log","name":"flow_logs","provider_config_key":"vpc:aws","expressions":{"iam_role_arn":{"references":["aws_iam_role.flow_logs[0].arn","aws_iam_role.flow_logs[0]","aws_iam_role.flow_logs"]},"log_destination":{"references":["aws_cloudwatch_log_group.flow_logs[0].arn","aws_cloudwatch_log_group.flow_logs[0]","aws_cloudwatch_log_group.flow_logs"]},"tags":{"references":["local.common_tags"]},"traffic_type":{"constant_value":"ALL"},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"aws_iam_policy.vpc_metrics_flow_logs_write_policy","mode":"managed","type":"aws_iam_policy","name":"vpc_metrics_flow_logs_write_policy","provider_config_key":"vpc:aws","expressions":{"description":{"constant_value":"IAM policy for writing flow logs in CloudWatch"},"name":{"constant_value":"VpcMetricsFlowLogsWrite"},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.vpc_metrics_flow_logs_write[0].json","data.aws_iam_policy_document.vpc_metrics_flow_logs_write[0]","data.aws_iam_policy_document.vpc_metrics_flow_logs_write"]},"tags":{"references":["local.common_tags"]}},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"aws_iam_role.flow_logs","mode":"managed","type":"aws_iam_role","name":"flow_logs","provider_config_key":"vpc:aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.vpc_flow_logs_service_principal[0].json","data.aws_iam_policy_document.vpc_flow_logs_service_principal[0]","data.aws_iam_policy_document.vpc_flow_logs_service_principal"]},"name":{"references":["var.name"]},"tags":{"references":["local.common_tags"]}},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"aws_iam_role_policy_attachment.vpc_metrics_flow_logs_write_policy_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"vpc_metrics_flow_logs_write_policy_attach","provider_config_key":"vpc:aws","expressions":{"policy_arn":{"references":["aws_iam_policy.vpc_metrics_flow_logs_write_policy[0].arn","aws_iam_policy.vpc_metrics_flow_logs_write_policy[0]","aws_iam_policy.vpc_metrics_flow_logs_write_policy"]},"role":{"references":["aws_iam_role.flow_logs[0].name","aws_iam_role.flow_logs[0]","aws_iam_role.flow_logs"]}},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"aws_internet_gateway.gw","mode":"managed","type":"aws_internet_gateway","name":"gw","provider_config_key":"vpc:aws","expressions":{"tags":{"references":["local.common_tags","var.name"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":0},{"address":"aws_nat_gateway.nat_gw","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","provider_config_key":"vpc:aws","expressions":{"allocation_id":{"references":["local.nat_gateway_ips","local.nat_gateway_ips","count.index"]},"connectivity_type":{"references":["var.enable_eip"]},"subnet_id":{"references":["aws_subnet.public","count.index"]},"tags":{"references":["local.common_tags","var.name","count.index"]}},"schema_version":0,"count_expression":{"references":["local.max_subnet_length"]},"depends_on":["aws_internet_gateway.gw"]},{"address":"aws_network_acl.main","mode":"managed","type":"aws_network_acl","name":"main","provider_config_key":"vpc:aws","expressions":{"subnet_ids":{"references":["aws_subnet.public","aws_subnet.private"]},"tags":{"references":["local.common_tags","var.name"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":0},{"address":"aws_network_acl_rule.block_rdp","mode":"managed","type":"aws_network_acl_rule","name":"block_rdp","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":false},"from_port":{"constant_value":3389},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"deny"},"rule_number":{"constant_value":51},"to_port":{"constant_value":3389}},"schema_version":0,"count_expression":{"references":["var.block_rdp"]}},{"address":"aws_network_acl_rule.block_ssh","mode":"managed","type":"aws_network_acl_rule","name":"block_ssh","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":false},"from_port":{"constant_value":22},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"deny"},"rule_number":{"constant_value":50},"to_port":{"constant_value":22}},"schema_version":0,"count_expression":{"references":["var.block_ssh"]}},{"address":"aws_network_acl_rule.https_request_egress_443","mode":"managed","type":"aws_network_acl_rule","name":"https_request_egress_443","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"constant_value":"0.0.0.0/0"},"egress":{"constant_value":true},"from_port":{"constant_value":443},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":60},"to_port":{"constant_value":443}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_out"]}},{"address":"aws_network_acl_rule.https_request_in_ingress_443","mode":"managed","type":"aws_network_acl_rule","name":"https_request_in_ingress_443","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"constant_value":"0.0.0.0/0"},"egress":{"constant_value":false},"from_port":{"constant_value":443},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":70},"to_port":{"constant_value":443}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_in"]}},{"address":"aws_network_acl_rule.https_request_in_ingress_ephemeral","mode":"managed","type":"aws_network_acl_rule","name":"https_request_in_ingress_ephemeral","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":false},"from_port":{"constant_value":1024},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":71},"to_port":{"constant_value":65535}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_in"]}},{"address":"aws_network_acl_rule.https_request_in_response_egress_443","mode":"managed","type":"aws_network_acl_rule","name":"https_request_in_response_egress_443","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":true},"from_port":{"constant_value":443},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":72},"to_port":{"constant_value":443}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_in_response"]}},{"address":"aws_network_acl_rule.https_request_in_response_egress_ephemeral","mode":"managed","type":"aws_network_acl_rule","name":"https_request_in_response_egress_ephemeral","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"constant_value":"0.0.0.0/0"},"egress":{"constant_value":true},"from_port":{"constant_value":1024},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":73},"to_port":{"constant_value":65535}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_in_response"]}},{"address":"aws_network_acl_rule.https_request_out_egress_ephemeral","mode":"managed","type":"aws_network_acl_rule","name":"https_request_out_egress_ephemeral","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":true},"from_port":{"constant_value":1024},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":61},"to_port":{"constant_value":65535}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_out"]}},{"address":"aws_network_acl_rule.https_request_out_response_ingress_443","mode":"managed","type":"aws_network_acl_rule","name":"https_request_out_response_ingress_443","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"egress":{"constant_value":false},"from_port":{"constant_value":443},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":62},"to_port":{"constant_value":443}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_out_response"]}},{"address":"aws_network_acl_rule.https_request_out_response_ingress_ephemeral","mode":"managed","type":"aws_network_acl_rule","name":"https_request_out_response_ingress_ephemeral","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"constant_value":"0.0.0.0/0"},"egress":{"constant_value":false},"from_port":{"constant_value":1024},"network_acl_id":{"references":["aws_network_acl.main.id","aws_network_acl.main"]},"protocol":{"constant_value":"tcp"},"rule_action":{"constant_value":"allow"},"rule_number":{"constant_value":63},"to_port":{"constant_value":65535}},"schema_version":0,"count_expression":{"references":["var.allow_https_request_out_response"]}},{"address":"aws_route.private_nat_gateway","mode":"managed","type":"aws_route","name":"private_nat_gateway","provider_config_key":"vpc:aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"nat_gateway_id":{"references":["aws_nat_gateway.nat_gw","count.index"]},"route_table_id":{"references":["aws_route_table.private","count.index"]},"timeouts":{"create":{"constant_value":"5m"}}},"schema_version":0,"count_expression":{"references":["local.max_subnet_length"]}},{"address":"aws_route.public_internet_gateway","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_config_key":"vpc:aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"gateway_id":{"references":["aws_internet_gateway.gw.id","aws_internet_gateway.gw"]},"route_table_id":{"references":["aws_route_table.public.id","aws_route_table.public"]},"timeouts":{"create":{"constant_value":"5m"}}},"schema_version":0},{"address":"aws_route_table.private","mode":"managed","type":"aws_route_table","name":"private","provider_config_key":"vpc:aws","expressions":{"tags":{"references":["local.common_tags","var.name","count.index"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":0,"count_expression":{"references":["local.max_subnet_length"]}},{"address":"aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_config_key":"vpc:aws","expressions":{"tags":{"references":["local.common_tags","var.name"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":0},{"address":"aws_route_table_association.private","mode":"managed","type":"aws_route_table_association","name":"private","provider_config_key":"vpc:aws","expressions":{"route_table_id":{"references":["aws_route_table.private","count.index"]},"subnet_id":{"references":["aws_subnet.private","count.index"]}},"schema_version":0,"count_expression":{"references":["aws_subnet.private"]}},{"address":"aws_route_table_association.public","mode":"managed","type":"aws_route_table_association","name":"public","provider_config_key":"vpc:aws","expressions":{"route_table_id":{"references":["aws_route_table.public.id","aws_route_table.public"]},"subnet_id":{"references":["aws_subnet.public","count.index"]}},"schema_version":0,"count_expression":{"references":["aws_subnet.public"]}},{"address":"aws_subnet.private","mode":"managed","type":"aws_subnet","name":"private","provider_config_key":"vpc:aws","expressions":{"availability_zone":{"references":["local.zone_names","count.index"]},"cidr_block":{"references":["var.high_availability","aws_vpc.main.cidr_block","aws_vpc.main","count.index","aws_vpc.main.cidr_block","aws_vpc.main"]},"tags":{"references":["local.common_tags","var.name","local.zone_names","count.index"]},"timeouts":{"delete":{"constant_value":"40m"}},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":1,"count_expression":{"references":["local.max_subnet_length"]}},{"address":"aws_subnet.public","mode":"managed","type":"aws_subnet","name":"public","provider_config_key":"vpc:aws","expressions":{"availability_zone":{"references":["local.zone_names","count.index"]},"cidr_block":{"references":["var.high_availability","aws_vpc.main.cidr_block","aws_vpc.main","count.index","local.max_subnet_length","aws_vpc.main.cidr_block","aws_vpc.main"]},"tags":{"references":["local.common_tags","var.name","local.zone_names","count.index"]},"vpc_id":{"references":["aws_vpc.main.id","aws_vpc.main"]}},"schema_version":1,"count_expression":{"references":["local.max_subnet_length"]}},{"address":"aws_vpc.main","mode":"managed","type":"aws_vpc","name":"main","provider_config_key":"vpc:aws","expressions":{"cidr_block":{"constant_value":"10.0.0.0/16"},"enable_dns_hostnames":{"constant_value":true},"enable_dns_support":{"constant_value":true},"tags":{"references":["local.common_tags","var.name"]}},"schema_version":1},{"address":"data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_config_key":"vpc:aws","expressions":{"state":{"constant_value":"available"}},"schema_version":0},{"address":"data.aws_iam_policy_document.vpc_flow_logs_service_principal","mode":"data","type":"aws_iam_policy_document","name":"vpc_flow_logs_service_principal","provider_config_key":"vpc:aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["vpc-flow-logs.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}},{"address":"data.aws_iam_policy_document.vpc_metrics_flow_logs_write","mode":"data","type":"aws_iam_policy_document","name":"vpc_metrics_flow_logs_write","provider_config_key":"vpc:aws","expressions":{"statement":[{"actions":{"constant_value":["logs:CreateLogStream","logs:PutLogEvents","logs:DescribeLogGroups","logs:DescribeLogStreams"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_cloudwatch_log_group.flow_logs[0].arn","aws_cloudwatch_log_group.flow_logs[0]","aws_cloudwatch_log_group.flow_logs","aws_cloudwatch_log_group.flow_logs[0].arn","aws_cloudwatch_log_group.flow_logs[0]","aws_cloudwatch_log_group.flow_logs"]}}]},"schema_version":0,"count_expression":{"references":["var.enable_flow_log"]}}],"variables":{"allow_https_request_in":{"default":false,"description":"(Optional, default 'false') Allow HTTPS connections on port 443 in from the internet"},"allow_https_request_in_response":{"default":false,"description":"(Optional, default 'false') Allow a response back to the internet in reply to a request"},"allow_https_request_out":{"default":false,"description":"(Optional, default 'false') Allow HTTPS connections on port 443 out to the internet"},"allow_https_request_out_response":{"default":false,"description":"(Optional, default 'false') Allow a response back from the internet in reply to a request"},"billing_tag_key":{"default":"CostCentre","description":"(Optional, default 'CostCentre') The name of the billing tag"},"billing_tag_value":{"description":"(Required) The value of the billing tag"},"block_rdp":{"default":true,"description":"(Optional, default 'true') Whether or not to block Port 3389"},"block_ssh":{"default":true,"description":"(Optional, default 'true') Whether or not to block Port 22"},"enable_eip":{"default":true,"description":"(Optional, default 'true') Enables Elastic IPs, disabling is mainly used for testing purposes"},"enable_flow_log":{"default":false,"description":"(Optional, default 'false') Whether or not to enable VPC Flow Logs"},"high_availability":{"default":false,"description":"(Optional, default 'false') Create 3 public and 3 private subnets across 3 availability zones in the region."},"name":{"description":"(Required) The name of the vpc"}}}}}}}}
